trigger:
  - main
pool:
  vmImage: windows-latest
steps:
  - task: NodeTool@0
    inputs:
      versionSpec: 12.x
    displayName: Install Node.js
  - powershell: >
      $Path = $env:TEMP; $Installer = "chrome_installer.exe"; Invoke-WebRequest
      "http://dl.google.com/chrome/install/375.126/chrome_installer.exe"
      -OutFile $Path\$Installer; Start-Process -FilePath $Path\$Installer -Args
      "/silent /install" -Verb RunAs -Wait; Remove-Item $Path\$Installer
  - script: |
      npm install
      npm install codeceptjs playwright --save
    displayName: 'Install npm, codecept'
  - script: |
      npm install        
      npx codeceptjs  run -c codecept.conf.js 
    displayName: Run Tests
  - task: PublishTestResults@2
    inputs:
      testResultsFormat: JUnit
      testResultsFiles: '**/TEST-*.xml'
      mergeTestResults: true
      failTaskOnFailedTests: true
      testRunTitle: TestResults
      publishRunAttachments: false
